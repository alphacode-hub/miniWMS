{% extends "base.html" %}
{% block title %}Inventario - Mini WMS{% endblock %}

{% block content %}
<div class="w-full max-w-4xl mx-auto px-4 py-4 sm:py-6">

    <section class="bg-white shadow-sm rounded-2xl border border-slate-100
                     px-4 py-4 sm:px-6 sm:py-5 space-y-4">

        <!-- HEADER -->
        <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <div>
                <p class="text-[11px] font-semibold text-slate-500 uppercase tracking-wide">
                    Paso 4 de 4 · Inventario físico
                </p>
                <h1 class="text-lg sm:text-xl font-semibold text-slate-900">
                    Inventario físico
                </h1>
                <p class="text-xs sm:text-sm text-slate-500 mt-1">
                    Compara el stock teórico con el conteo real en bodega y ajusta diferencias automáticamente.
                </p>
            </div>

            <a href="/dashboard"
               class="hidden sm:inline-flex items-center text-[11px] text-slate-500 hover:text-slate-700 hover:underline">
                ← Volver al dashboard
            </a>
        </header>

        {% if stock_items|length == 0 %}

        <!-- ESTADO VACÍO -->
        <p class="text-xs text-slate-500 mt-1">
            No hay productos con movimientos aún.
            Primero registra <span class="font-semibold">entradas</span> para poder hacer inventario.
        </p>

        {% else %}

        <!-- FORMULARIO INVENTARIO -->
        <form method="post" action="/inventario" class="space-y-3">

            <!-- total_items para el backend -->
            <input type="hidden" name="total_items" value="{{ stock_items|length }}" />

            <!-- LISTA DE ITEMS -->
            <div class="space-y-3 max-h-[480px] overflow-y-auto pr-1">
                {% for item in stock_items %}
                {% set i = loop.index0 %}

                <div class="border border-slate-200 rounded-xl px-3 py-2 bg-slate-50">
                    <!-- Hidden fields -->
                    <input type="hidden" name="producto_{{ i }}" value="{{ item.producto }}">
                    <input type="hidden" name="zona_{{ i }}" value="{{ item.zona }}">

                    <div class="flex justify-between items-start gap-2">
                        <div>
                            <div class="text-[11px] font-semibold text-slate-800">
                                {{ item.producto }}
                            </div>
                            <div class="text-[10px] text-slate-500">
                                Ubicación:
                                <span class="font-mono">{{ item.zona }}</span>
                            </div>
                            <div class="mt-1 text-[10px] text-slate-500">
                                Stock teórico:
                                <span class="font-semibold text-slate-800">
                                    {{ item.stock_actual }}
                                </span>
                            </div>
                        </div>

                        <div class="w-20">
                            <label class="block text-[10px] text-slate-500 mb-1">
                                Conteo
                            </label>
                            <input type="number"
                                   name="conteo_{{ i }}"
                                   min="0"
                                   class="w-full rounded-lg border border-slate-300 px-2 py-1 text-right text-[11px]
                                          focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500
                                          appearance-none"
                                   placeholder="{{ item.stock_actual }}" />
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- BOTONES -->
            <div class="flex flex-col sm:flex-row sm:justify-end gap-2 pt-2">
                <a href="/dashboard"
                   class="w-full sm:w-auto inline-flex items-center justify-center px-3 py-2 rounded-xl text-[11px] font-semibold
                          border border-slate-300 text-slate-700 hover:bg-slate-50">
                    Cancelar
                </a>
                <button type="submit"
                        class="w-full sm:w-auto inline-flex items-center justify-center px-3 py-2 rounded-xl
                               text-[11px] font-semibold bg-slate-900 text-white shadow-sm
                               hover:bg-slate-800 active:scale-[0.97] transition">
                    Registrar ajustes
                </button>
            </div>

            <!-- PIE / LEYENDA -->
            <div class="mt-3 pt-3 border-t border-slate-100">
                <p class="text-[11px] text-slate-500">
                    Para cada producto y ubicación, ingresa el conteo físico. Si es distinto al stock teórico,
                    se generará automáticamente un movimiento de <span class="font-semibold">ajuste</span> para cuadrar el inventario.
                </p>
            </div>

        </form>

        {% endif %}

    </section>

    <!-- VOLVER (MÓVIL) -->
    <a href="/dashboard"
       class="block mt-3 text-center text-xs text-slate-500 sm:hidden hover:text-slate-700">
        ← Volver al dashboard
    </a>

</div>
{% endblock %}
