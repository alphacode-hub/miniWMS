{% extends "base.html" %}
{% block title %}Auditoría - Mini WMS{% endblock %}

{% block content %}
<div class="w-full max-w-5xl mx-auto px-4 py-4 sm:py-6">

    <section class="bg-white shadow-sm rounded-2xl border border-slate-100
                     px-4 py-4 sm:px-6 sm:py-5 space-y-4">

        <!-- HEADER -->
        <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <div>
                <h1 class="text-lg sm:text-xl font-semibold text-slate-900">
                    Auditoría del negocio
                </h1>
                <p class="text-xs sm:text-sm text-slate-500 mt-1">
                    Registro detallado de acciones realizadas en {{ user.negocio }}:
                    creación, edición, eliminación y otros eventos relevantes.
                </p>

                <p class="mt-2 text-[11px] text-slate-500 space-x-2">
                    <span>
                        Admin:
                        <span class="font-medium text-slate-800">{{ user.email }}</span>
                    </span>
                </p>
            </div>
        </header>

        <!-- CONTENIDO PRINCIPAL -->
        <div class="space-y-3">

            {% if registros|length == 0 %}
            <!-- Estado vacío -->
            <div class="rounded-2xl border border-slate-200 bg-slate-50 px-4 py-6 text-center space-y-2">
                <p class="text-sm font-medium text-slate-800">
                    No hay registros de auditoría aún.
                </p>
                <p class="text-xs text-slate-500 max-w-sm mx-auto">
                    A medida que se creen, editen o eliminen datos en el sistema,
                    verás aquí un historial detallado de las acciones realizadas por tu equipo.
                </p>
            </div>

            {% else %}

            <!-- Caja scrollable con tabla -->
            <div class="max-h-[520px] overflow-y-auto border border-slate-200 rounded-2xl">
                <table class="w-full text-xs border-collapse">
                    <thead class="bg-slate-50/90 sticky top-0 z-10 border-b border-slate-100">
                        <tr class="text-left text-[11px] text-slate-500 uppercase tracking-wide">
                            <th class="py-1.5 px-2">Fecha</th>
                            <th class="py-1.5 px-2">Usuario</th>
                            <th class="py-1.5 px-2">Acción</th>
                            <th class="py-1.5 px-2">Detalle</th>
                        </tr>
                    </thead>

                    <tbody class="bg-white divide-y divide-slate-100">
                        {% for r in registros %}
                        <tr class="hover:bg-slate-50/70">
                            <!-- Fecha -->
                            <td class="py-1.5 px-2 align-top whitespace-nowrap">
                                <div class="text-[11px] text-slate-800">
                                    {{ r.fecha.strftime("%Y-%m-%d") }}
                                </div>
                                <div class="text-[10px] text-slate-400">
                                    {{ r.fecha.strftime("%H:%M:%S") }}
                                </div>
                            </td>

                            <!-- Usuario -->
                            <td class="py-1.5 px-2 align-top">
                                <span class="text-[11px] text-slate-800">
                                    {{ r.usuario }}
                                </span>
                            </td>

                            <!-- Acción -->
                            <td class="py-1.5 px-2 align-top">
                                <span class="inline-flex px-2 py-[2px] rounded-full text-[10px] font-semibold
                                             bg-slate-50 text-slate-700 border border-slate-200">
                                    {{ r.accion }}
                                </span>
                            </td>

                            <!-- Detalle -->
                            <td class="py-1.5 px-2 align-top">
                                <pre class="text-[10px] text-slate-700 whitespace-pre-wrap font-mono leading-tight">
{{ r.detalle }}
                                </pre>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% endif %}
        </div>

        <!-- PIE / SIGUIENTE PASO -->
        <footer class="pt-3 border-t border-slate-100 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1">
            <p class="text-[11px] text-slate-500">
                Siguiente paso recomendado:
                <span class="font-semibold text-slate-800">
                    revisar periódicamente esta auditoría
                </span>
                para detectar usos indebidos o errores operacionales.
            </p>

            <a href="/dashboard"
               class="block text-center sm:text-right text-[11px] text-slate-500 hover:text-slate-700">
                ← Volver al dashboard
            </a>
        </footer>

    </section>
</div>
{% endblock %}
