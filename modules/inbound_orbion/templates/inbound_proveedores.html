{# modules/inbound_orbion/templates/inbound_proveedores.html #}
{% extends "base/base_app.html" %}

{% block title %}ORBION · Proveedores Inbound{% endblock %}

{% block content %}
<div class="space-y-6 sm:space-y-8 max-w-5xl mx-auto">

    {# =========================
    HEADER (mobile-first, 1 solo)
    ========================= #}
    <header class="flex items-start sm:items-center justify-between gap-3">
        <div class="min-w-0 space-y-1">
            <p class="text-[11px] font-semibold tracking-wide text-slate-400 uppercase">
                Inbound · Proveedores
            </p>
            <h1 class="text-base sm:text-lg font-semibold text-slate-100 tracking-tight truncate">
                Gestión de proveedores del negocio
            </h1>
            <p class="text-[11px] sm:text-xs text-slate-400 leading-snug max-w-xl">
                Crea y administra proveedores (multi-tenant), activa/desactiva y deja lista la base para Citas y Prealertas.
            </p>
        </div>

        <div class="shrink-0">
            <a href="/inbound/recepciones"
               class="inline-flex items-center rounded-full border border-slate-700 px-3 py-1.5
                text-[11px] font-medium text-slate-300 hover:border-cyan-400 hover:text-cyan-300 transition-colors">
                ← Volver a recepciones
            </a>
        </div>
    </header>

    {# =========================
    ALERTAS / MENSAJES
    ========================= #}
    {% set ok_msg = (ok if ok is defined else (request.query_params.get("ok") if request else None)) %}
    {% set err_msg = (error if error is defined else (request.query_params.get("error") if request else None)) %}

    {% if err_msg %}
    <div class="rounded-2xl border border-rose-500/30 bg-rose-500/10 px-3 py-3 sm:px-4">
        <p class="text-[11px] text-rose-100 font-semibold">No se pudo completar la acción</p>
        <p class="text-[11px] text-rose-200/90 mt-1">{{ err_msg }}</p>
    </div>
    {% endif %}

    {% if ok_msg %}
    <div class="rounded-2xl border border-emerald-500/25 bg-emerald-500/10 px-3 py-3 sm:px-4">
        <p class="text-[11px] text-emerald-100 font-semibold">Listo</p>
        <p class="text-[11px] text-emerald-200/90 mt-1">{{ ok_msg }}</p>
    </div>
    {% endif %}

    {# =========================
    NUEVO PROVEEDOR
    ========================= #}
    <section class="rounded-2xl border border-slate-800 bg-slate-900/60">
        <div class="px-4 py-4 sm:px-5 border-b border-slate-800/80">
            <div class="flex items-start justify-between gap-3">
                <div class="space-y-0.5">
                    <h2 class="text-sm font-semibold text-slate-100">Nuevo proveedor</h2>
                    <p class="text-[11px] text-slate-400">
                        Registra un proveedor para usarlo en recepciones, checklists y más adelante en citas/prealertas.
                    </p>
                </div>
            </div>
        </div>

        <form method="post" action="/inbound/proveedores/nuevo" class="px-4 py-4 sm:px-5 space-y-4">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-12 gap-3">

                <div class="lg:col-span-5 space-y-1">
                    <label class="block text-[11px] font-semibold text-slate-200">Nombre *</label>
                    <input name="nombre" required
                           class="w-full rounded-xl border border-slate-700 bg-slate-900 px-3 py-2
                        text-xs sm:text-sm text-slate-100 placeholder-slate-500
                        focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                           placeholder="Ej: Proveedor ABC SpA" />
                </div>

                <div class="lg:col-span-3 space-y-1">
                    <label class="block text-[11px] font-semibold text-slate-200">RUT</label>
                    <input name="rut"
                           class="w-full rounded-xl border border-slate-700 bg-slate-900 px-3 py-2
                        text-xs sm:text-sm text-slate-100 placeholder-slate-500
                        focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                           placeholder="Ej: 76.123.456-7" />
                </div>

                <div class="lg:col-span-4 space-y-1">
                    <label class="block text-[11px] font-semibold text-slate-200">Contacto</label>
                    <input name="contacto"
                           class="w-full rounded-xl border border-slate-700 bg-slate-900 px-3 py-2
                        text-xs sm:text-sm text-slate-100 placeholder-slate-500
                        focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                           placeholder="Ej: Juan Pérez" />
                </div>

                <div class="lg:col-span-3 space-y-1">
                    <label class="block text-[11px] font-semibold text-slate-200">Teléfono</label>
                    <input name="telefono"
                           class="w-full rounded-xl border border-slate-700 bg-slate-900 px-3 py-2
                        text-xs sm:text-sm text-slate-100 placeholder-slate-500
                        focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                           placeholder="+56 9 ..." />
                </div>

                <div class="lg:col-span-5 space-y-1">
                    <label class="block text-[11px] font-semibold text-slate-200">Email</label>
                    <input name="email" type="email"
                           class="w-full rounded-xl border border-slate-700 bg-slate-900 px-3 py-2
                        text-xs sm:text-sm text-slate-100 placeholder-slate-500
                        focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                           placeholder="contacto@proveedor.cl" />
                </div>

                <div class="lg:col-span-4 space-y-1">
                    <label class="block text-[11px] font-semibold text-slate-200">Dirección</label>
                    <input name="direccion"
                           class="w-full rounded-xl border border-slate-700 bg-slate-900 px-3 py-2
                        text-xs sm:text-sm text-slate-100 placeholder-slate-500
                        focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                           placeholder="Comuna / Dirección" />
                </div>

                <div class="lg:col-span-12 space-y-1">
                    <label class="block text-[11px] font-semibold text-slate-200">Observaciones</label>
                    <textarea name="observaciones" rows="2"
                              class="w-full rounded-xl border border-slate-700 bg-slate-900 px-3 py-2
                           text-xs sm:text-sm text-slate-100 placeholder-slate-500
                           focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                              placeholder="Notas internas..."></textarea>
                </div>
            </div>

            <div class="pt-1 flex items-center justify-end gap-2">
                <button type="submit"
                        class="inline-flex items-center justify-center rounded-full px-5 py-2
                       text-[11px] font-semibold text-slate-900 bg-[#00E4FF]
                       hover:bg-cyan-300 active:scale-[0.97]
                       transition-transform transition-colors">
                    Crear proveedor
                </button>
            </div>
        </form>
    </section>

    

    {# =========================
    LISTADO
    ========================= #}
    <section class="rounded-2xl border border-slate-800 bg-slate-900/60">
        <header class="px-4 py-4 sm:px-5 border-b border-slate-800/80">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                <div class="space-y-0.5">
                    <h2 class="text-sm font-semibold text-slate-100">Listado</h2>
                    <p class="text-[11px] text-slate-400">Visualiza y administra el estado de cada proveedor.</p>
                </div>

                <div class="flex items-center gap-2">
                    <span class="inline-flex items-center rounded-full border border-slate-700 px-3 py-1 text-[11px] text-slate-300">
                        Total: {{ total }}
                    </span>

                    <span class="inline-flex items-center rounded-full border border-emerald-500/25 bg-emerald-500/10 px-3 py-1 text-[11px] text-emerald-200">
                        Activos: {{ activos }}
                    </span>

                    <span class="inline-flex items-center rounded-full border border-slate-700 bg-slate-950/20 px-3 py-1 text-[11px] text-slate-300">
                        Inactivos: {{ inactivos }}
                    </span>
                </div>

            </div>
        </header>

        {# =========================
        MOBILE: cards
        ========================= #}
        <div class="block sm:hidden divide-y divide-slate-800/70">
            {% for p in (proveedores or []) %}
            <div class="px-4 py-4 space-y-2">
                <div class="flex items-start justify-between gap-3">
                    <div class="min-w-0">
                        <div class="text-sm font-semibold text-slate-100 truncate">{{ p.nombre }}</div>
                        <div class="text-[11px] text-slate-400 mt-0.5">
                            {% if p.rut %}<span class="mr-2">RUT: {{ p.rut }}</span>{% endif %}
                            <span class="text-slate-500">#{{ p.id }}</span>
                        </div>
                    </div>

                    <div class="shrink-0">
                        {% if p.activo %}
                        <span class="px-2 py-1 rounded-lg text-[11px] font-semibold bg-emerald-500/15 text-emerald-200 border border-emerald-500/20">
                            Activo
                        </span>
                        {% else %}
                        <span class="px-2 py-1 rounded-lg text-[11px] font-semibold bg-slate-500/10 text-slate-300 border border-slate-700/60">
                            Inactivo
                        </span>
                        {% endif %}
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-1 text-[11px] text-slate-300">
                    <div><span class="text-slate-500">Contacto:</span> {{ p.contacto or "—" }}</div>
                    <div><span class="text-slate-500">Email:</span> {{ p.email or "—" }}</div>
                    <div><span class="text-slate-500">Teléfono:</span> {{ p.telefono or "—" }}</div>
                </div>

                <div class="pt-2 flex items-center justify-end gap-2">
                    <a href="/inbound/proveedores/{{ p.id }}/plantillas"
                       class="px-3 py-2 rounded-lg text-[11px] font-semibold border
                              bg-slate-900/50 hover:bg-slate-900 text-slate-100 border-slate-700/60">
                        Plantillas →
                    </a>

                    <form method="post" action="/inbound/proveedores/{{ p.id }}/estado" class="inline">
                        <input type="hidden" name="activo" value="{{ 'false' if p.activo else 'true' }}">
                        <button type="submit"
                                class="px-3 py-2 rounded-lg text-[11px] font-semibold border
                           {% if p.activo %}
                           bg-slate-900/50 hover:bg-slate-900 text-slate-100 border-slate-700/60
                           {% else %}
                           bg-emerald-500/90 hover:bg-emerald-500 text-emerald-950 border-emerald-400/40
                           {% endif %}">
                            {% if p.activo %}Desactivar{% else %}Activar{% endif %}
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}

            {% if not proveedores %}
            <div class="px-4 py-8 text-center text-slate-400 text-sm">
                Aún no hay proveedores. Crea el primero arriba.
            </div>
            {% endif %}
        </div>

        {# =========================
        DESKTOP/TABLET: table
        ========================= #}
        <div class="hidden sm:block overflow-x-auto">
            <table class="min-w-full text-sm">
                <thead class="text-xs text-slate-400">
                    <tr class="border-b border-slate-800/60">
                        <th class="text-left font-semibold px-4 py-3">Proveedor</th>
                        <th class="text-left font-semibold px-4 py-3 hidden md:table-cell">Contacto</th>
                        <th class="text-left font-semibold px-4 py-3 hidden lg:table-cell">Email</th>
                        <th class="text-left font-semibold px-4 py-3 hidden lg:table-cell">Teléfono</th>
                        <th class="text-left font-semibold px-4 py-3">Estado</th>
                        <th class="text-right font-semibold px-4 py-3">Acción</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-800/60">
                    {% for p in (proveedores or []) %}
                    <tr class="hover:bg-slate-950/30">
                        <td class="px-4 py-3">
                            <div class="font-semibold text-slate-100">{{ p.nombre }}</div>
                            <div class="text-xs text-slate-400 mt-1">
                                {% if p.rut %}<span class="mr-2">RUT: {{ p.rut }}</span>{% endif %}
                                <span class="text-slate-500">#{{ p.id }}</span>
                            </div>
                        </td>

                        <td class="px-4 py-3 hidden md:table-cell text-slate-200">
                            {{ p.contacto or "—" }}
                        </td>

                        <td class="px-4 py-3 hidden lg:table-cell text-slate-200">
                            {{ p.email or "—" }}
                        </td>

                        <td class="px-4 py-3 hidden lg:table-cell text-slate-200">
                            {{ p.telefono or "—" }}
                        </td>

                        <td class="px-4 py-3">
                            {% if p.activo %}
                            <span class="px-2 py-1 rounded-lg text-xs font-semibold bg-emerald-500/15 text-emerald-200 border border-emerald-500/20">
                                Activo
                            </span>
                            {% else %}
                            <span class="px-2 py-1 rounded-lg text-xs font-semibold bg-slate-500/10 text-slate-300 border border-slate-700/60">
                                Inactivo
                            </span>
                            {% endif %}
                        </td>

                        <td class="px-4 py-3 text-right">
                            <div class="inline-flex items-center gap-2">
                                <a href="/inbound/proveedores/{{ p.id }}/plantillas"
                                   class="px-3 py-2 rounded-lg text-xs font-semibold border
                                          bg-slate-900/50 hover:bg-slate-900 text-slate-100 border-slate-700/60">
                                    Plantillas →
                                </a>

                                <form method="post" action="/inbound/proveedores/{{ p.id }}/estado" class="inline">
                                    <input type="hidden" name="activo" value="{{ 'false' if p.activo else 'true' }}">
                                    <button type="submit"
                                            class="px-3 py-2 rounded-lg text-xs font-semibold border
                               {% if p.activo %}
                               bg-slate-900/50 hover:bg-slate-900 text-slate-100 border-slate-700/60
                               {% else %}
                               bg-emerald-500/90 hover:bg-emerald-500 text-emerald-950 border-emerald-400/40
                               {% endif %}">
                                        {% if p.activo %}Desactivar{% else %}Activar{% endif %}
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}

                    {% if not proveedores %}
                    <tr>
                        <td colspan="6" class="px-4 py-10 text-center text-slate-400">
                            Aún no hay proveedores. Crea el primero arriba.
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </section>

</div>
{% endblock %}
