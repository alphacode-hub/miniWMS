{# templates/inbound_proveedores.html #}
{% extends "base/base_app.html" %}

{% block title %}Inbound · Proveedores{% endblock %}

{% block content %}
<div class="w-full max-w-6xl mx-auto px-4 py-5 sm:py-7 space-y-5">

    <!-- Header -->
    <div class="flex items-start justify-between gap-3">
        <div class="min-w-0">
            <h1 class="text-lg sm:text-xl font-semibold text-slate-100">Proveedores</h1>
            <p class="text-xs sm:text-sm text-slate-300 mt-1">
                Gestiona proveedores del negocio (multi-tenant), activa/desactiva y prepara la base para Citas.
            </p>
        </div>

        <div class="flex items-center gap-2 shrink-0">
            <a href="/inbound/recepciones"
               class="inline-flex items-center rounded-full border border-slate-700 px-3 py-1.5
                text-[11px] font-medium text-slate-300 hover:border-cyan-400 hover:text-cyan-300 transition-colors">
                ← Volver a recepción
            </a>
            <a href="/inbound/proveedores/plantillas"
               class="px-3 py-2 rounded-lg bg-slate-900/50 hover:bg-slate-900 text-slate-100 text-xs font-semibold border border-slate-700/60">
                Plantillas
            </a>
        </div>
    </div>

    <!-- Alerts (querystring) -->
    {% set ok = request.query_params.get("ok") if request else None %}
    {% set error = request.query_params.get("error") if request else None %}

    {% if error %}
    <div class="rounded-xl border border-rose-500/20 bg-rose-500/10 px-4 py-3 text-rose-100">
        <div class="text-sm font-semibold">Error</div>
        <div class="text-sm text-rose-100/90 mt-1">{{ error }}</div>
    </div>
    {% endif %}

    {% if ok %}
    <div class="rounded-xl border border-emerald-500/20 bg-emerald-500/10 px-4 py-3 text-emerald-100">
        <div class="text-sm font-semibold">Listo</div>
        <div class="text-sm text-emerald-100/90 mt-1">{{ ok }}</div>
    </div>
    {% endif %}

    <!-- Crear proveedor -->
    <div class="rounded-2xl bg-slate-900/50 border border-slate-800/60">
        <div class="p-4 border-b border-slate-800/60">
            <div class="text-sm font-semibold text-slate-100">Nuevo proveedor</div>
            <div class="text-xs text-slate-400 mt-1">Registra un proveedor para usarlo en recepciones y citas.</div>
        </div>

        <form method="post" action="/inbound/proveedores/nuevo" class="p-4">
            <div class="grid grid-cols-1 md:grid-cols-12 gap-3">
                <div class="md:col-span-5">
                    <label class="block text-xs font-semibold text-slate-300 mb-2">Nombre *</label>
                    <input name="nombre" required
                           class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-700/60 text-slate-100 text-sm
                        focus:outline-none focus:ring-2 focus:ring-cyan-400/30"
                           placeholder="Ej: Proveedor ABC SpA" />
                </div>

                <div class="md:col-span-3">
                    <label class="block text-xs font-semibold text-slate-300 mb-2">RUT</label>
                    <input name="rut"
                           class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-700/60 text-slate-100 text-sm
                        focus:outline-none focus:ring-2 focus:ring-cyan-400/30"
                           placeholder="Ej: 76.123.456-7" />
                </div>

                <div class="md:col-span-4">
                    <label class="block text-xs font-semibold text-slate-300 mb-2">Contacto</label>
                    <input name="contacto"
                           class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-700/60 text-slate-100 text-sm
                        focus:outline-none focus:ring-2 focus:ring-cyan-400/30"
                           placeholder="Ej: Juan Pérez" />
                </div>

                <div class="md:col-span-3">
                    <label class="block text-xs font-semibold text-slate-300 mb-2">Teléfono</label>
                    <input name="telefono"
                           class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-700/60 text-slate-100 text-sm
                        focus:outline-none focus:ring-2 focus:ring-cyan-400/30"
                           placeholder="+56 9 ..." />
                </div>

                <div class="md:col-span-5">
                    <label class="block text-xs font-semibold text-slate-300 mb-2">Email</label>
                    <input name="email" type="email"
                           class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-700/60 text-slate-100 text-sm
                        focus:outline-none focus:ring-2 focus:ring-cyan-400/30"
                           placeholder="contacto@proveedor.cl" />
                </div>

                <div class="md:col-span-4">
                    <label class="block text-xs font-semibold text-slate-300 mb-2">Dirección</label>
                    <input name="direccion"
                           class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-700/60 text-slate-100 text-sm
                        focus:outline-none focus:ring-2 focus:ring-cyan-400/30"
                           placeholder="Comuna / Dirección" />
                </div>

                <div class="md:col-span-12">
                    <label class="block text-xs font-semibold text-slate-300 mb-2">Observaciones</label>
                    <textarea name="observaciones" rows="2"
                              class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-700/60 text-slate-100 text-sm
                           focus:outline-none focus:ring-2 focus:ring-cyan-400/30"
                              placeholder="Notas internas..."></textarea>
                </div>
            </div>

            <div class="mt-4 flex items-center justify-end">
                <button type="submit"
                        class="px-3 py-2 rounded-lg bg-cyan-500/90 hover:bg-cyan-500 text-cyan-950 text-xs font-semibold border border-cyan-400/40">
                    Crear proveedor
                </button>
            </div>
        </form>
    </div>

    <!-- Lista proveedores -->
    <div class="rounded-2xl bg-slate-900/50 border border-slate-800/60">
        <div class="p-4 border-b border-slate-800/60">
            <div class="flex items-center justify-between gap-3">
                <div class="text-sm font-semibold text-slate-100">Listado</div>
                <div class="text-xs text-slate-400">
                    {% if proveedores %}{{ proveedores|length }}{% else %}0{% endif %} proveedores
                </div>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
                <thead class="text-xs text-slate-400">
                    <tr class="border-b border-slate-800/60">
                        <th class="text-left font-semibold px-4 py-3">Proveedor</th>
                        <th class="text-left font-semibold px-4 py-3 hidden md:table-cell">Contacto</th>
                        <th class="text-left font-semibold px-4 py-3 hidden lg:table-cell">Email</th>
                        <th class="text-left font-semibold px-4 py-3 hidden lg:table-cell">Teléfono</th>
                        <th class="text-left font-semibold px-4 py-3">Estado</th>
                        <th class="text-right font-semibold px-4 py-3">Acción</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-800/60">
                    {% for p in (proveedores or []) %}
                    <tr class="hover:bg-slate-950/30">
                        <td class="px-4 py-3">
                            <div class="font-semibold text-slate-100">{{ p.nombre }}</div>
                            <div class="text-xs text-slate-400 mt-1">
                                {% if p.rut %}<span class="mr-2">RUT: {{ p.rut }}</span>{% endif %}
                                <span class="text-slate-500">#{{ p.id }}</span>
                            </div>
                        </td>

                        <td class="px-4 py-3 hidden md:table-cell text-slate-200">
                            {{ p.contacto or "—" }}
                        </td>

                        <td class="px-4 py-3 hidden lg:table-cell text-slate-200">
                            {{ p.email or "—" }}
                        </td>

                        <td class="px-4 py-3 hidden lg:table-cell text-slate-200">
                            {{ p.telefono or "—" }}
                        </td>

                        <td class="px-4 py-3">
                            {% if p.activo %}
                            <span class="px-2 py-1 rounded-lg text-xs font-semibold bg-emerald-500/15 text-emerald-200 border border-emerald-500/20">
                                Activo
                            </span>
                            {% else %}
                            <span class="px-2 py-1 rounded-lg text-xs font-semibold bg-slate-500/10 text-slate-300 border border-slate-700/60">
                                Inactivo
                            </span>
                            {% endif %}
                        </td>

                        <td class="px-4 py-3 text-right">
                            <form method="post" action="/inbound/proveedores/{{ p.id }}/estado" class="inline">
                                <input type="hidden" name="activo" value="{{ 'false' if p.activo else 'true' }}">
                                <button type="submit"
                                        class="px-3 py-2 rounded-lg text-xs font-semibold border
                               {% if p.activo %}
                               bg-slate-900/50 hover:bg-slate-900 text-slate-100 border-slate-700/60
                               {% else %}
                               bg-emerald-500/90 hover:bg-emerald-500 text-emerald-950 border-emerald-400/40
                               {% endif %}">
                                    {% if p.activo %}Desactivar{% else %}Activar{% endif %}
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                    
                    {% if not proveedores %}
                    <tr>
                        <td colspan="6" class="px-4 py-8 text-center text-slate-400">
                            Aún no hay proveedores. Crea el primero arriba.
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

</div>
{% endblock %}
